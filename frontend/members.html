<!doctype html>
<html>
<head>
  <meta charset="utf-8">
  <title>Members â€” Power Gym</title>
  <link rel="stylesheet" href="style.css">
  <script src="app.js" defer></script>
</head>
<body>
<div class="sidebar">
  <div class="sidebar-header">
    <h3>ğŸ‹ï¸ POWER GYM</h3>
    <button class="dark-toggle" onclick="toggleDarkMode()">ğŸŒ™</button>
  </div>
  <div class="sidebar-nav">
    <a href="index.html"><span class="icon">ğŸ </span> Home</a>
    <a href="dashboard.html"><span class="icon">ğŸ“Š</span> Dashboard</a>
    <a href="members.html"><span class="icon">ğŸ‘¥</span> Members</a>
    <a href="trainer.html"><span class="icon">ğŸ…</span> Trainers</a>
    <a href="equipment.html"><span class="icon">ğŸ§°</span> Equipment</a>
    <a href="plans.html"><span class="icon">ğŸ“¦</span> Plans</a>
    <a href="payments.html"><span class="icon">ğŸ’³</span> Payments</a>
    <a href="attendance.html"><span class="icon">ğŸ“</span> Attendance</a>
    <a href="#" onclick="logout()"><span class="icon">ğŸšª</span> Logout</a>
  </div>
</div>

<div class="page-content">
  <script> requireAuth(); </script>
  <script> requireAdmin(); </script>

  <div class="header-row">
    <h1>Members</h1>
    <span class="badge">Manage Members</span>
  </div>

  <!-- ================= ADD MEMBER ================= -->
  <div class="container card">
    <h3>Add Member</h3>
    <p class="small mb-10">Register a new member to the gym.</p>

    <form id="memberForm">
      <input name="name" placeholder="Full name" required>
      <input name="email" type="email" placeholder="email@example.com" required>
      <input name="phone" placeholder="Phone number" required>
      <input name="plan_id" placeholder="Plan ID (optional)">
      <button type="submit">Add Member</button>
    </form>

    <p id="memberMsg" class="small mt-10"></p>
  </div>

  <!-- ================= MEMBER LIST ================= -->
  <div class="container mt-10 card">
    <div class="header-row" style="margin-bottom:8px;">
      <h3>All Members</h3>
      <div class="small">Search, export & manage members</div>
    </div>

    <!-- ğŸ” SEARCH -->
    <input
      type="text"
      id="memberSearch"
      placeholder="Search by name, email, or phone..."
      style="margin-bottom:10px;"
    >

    <!-- ğŸ“¤ EXPORT -->
    <button id="exportMembersBtn" style="margin-bottom:10px;">
      Export Members to CSV
    </button>

    <table id="membersTable">
      <thead></thead>
      <tbody></tbody>
    </table>

    <div id="emptyState" class="small mt-10" style="display:none;">
      No members found.
    </div>
  </div>
</div>

<!-- ================= SCRIPT ================= -->
<script>
  // UX feedback on add
  (function(){
    const f = document.getElementById("memberForm");
    const m = document.getElementById("memberMsg");
    if(f && m){
      f.addEventListener("submit", () => {
        m.innerText = "Adding member...";
      });
    }
  })();

  // ğŸ” Live search filter
  document.getElementById("memberSearch").addEventListener("keyup", function(){
    const value = this.value.toLowerCase();
    const rows = document.querySelectorAll("#membersTable tbody tr");
    let visible = 0;

    rows.forEach(row => {
      const text = row.innerText.toLowerCase();
      const show = text.includes(value);
      row.style.display = show ? "" : "none";
      if(show) visible++;
    });

    document.getElementById("emptyState").style.display =
      visible === 0 ? "block" : "none";
  });

  // ğŸ“¤ EXPORT MEMBERS TO CSV
  document.getElementById("exportMembersBtn").addEventListener("click", function(){
    const rows = document.querySelectorAll("#membersTable tr");
    if(!rows.length){
      alert("No members to export");
      return;
    }

    let csv = [];
    rows.forEach(row => {
      const cols = row.querySelectorAll("th, td");
      let rowData = [];
      cols.forEach(col => {
        rowData.push('"' + col.innerText.replace(/"/g,'""') + '"');
      });
      csv.push(rowData.join(","));
    });

    const blob = new Blob([csv.join("\n")], { type: "text/csv" });
    const url = URL.createObjectURL(blob);
    const a = document.createElement("a");
    a.href = url;
    a.download = "members.csv";
    a.click();
    URL.revokeObjectURL(url);
  });
</script>

</body>
</html>
